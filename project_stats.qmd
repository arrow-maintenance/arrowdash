## Row

```{r}
#| echo: false
library(ggplot2)
library(readr)
library(tidyr)
library(bslib)
library(bsicons)
library(dplyr)
library(lubridate)

# Load data
open_counts <- read_csv("data/open_counts.csv", col_types = cols(
  date = col_date(),
  open_issues = col_integer(),
  open_prs = col_integer()
))

current_issues <- open_counts %>%
  filter(date == max(date)) %>%
  pull(open_issues)

month_ago_issues <- open_counts %>%
  filter(date == max(date) - months(1)) %>%
  pull(open_issues)

current_prs <- open_counts %>%
  filter(date == max(date)) %>%
  pull(open_prs)

month_ago_prs <- open_counts %>%
  filter(date == max(date) - months(1)) %>%
  pull(open_prs)

change_issues <- current_issues - month_ago_issues
change_prs <- current_prs - month_ago_prs

get_sign_string <- function(x){
  switch (as.character(sign(x)),
    "1" = paste0("+", x),
    "0" = paste0("+", x),
    "-1" = paste(x),
    ""
  )
}
```

```{r}
value_box(
  title = "Open Issues (and change since 1 month ago)",
  showcase = bsicons::bs_icon("chat"),
  theme = "primary",
  value = glue::glue("{current_issues} ({get_sign_string(change_issues)})")
)
```

```{r}
value_box(
  title = "Open PRs (and change since 1 month ago)",
  showcase = bsicons::bs_icon("pencil"),
  theme = "primary",
  value = glue::glue("{current_prs} ({get_sign_string(change_prs)})")
)
```

## Row

```{r}
#| echo: false
library(ggplot2)
library(readr)
monthly_commit_counts <- readr::read_csv("./data/monthly_commit_counts.csv") %>%
  mutate(date = as.Date(paste0(month, "-01"))) %>%
  filter(date > as.Date("2024-04-01")) %>%
  filter(date < floor_date(Sys.Date(), "month")) %>%
  arrange(date)

ggplot(monthly_commit_counts, aes(x = date)) +
  geom_line(aes(y = commit_count, color = "Raw values"), linewidth = 1) +
  geom_smooth(aes(y = commit_count, color = "Trend"), span = 1.1, method = "loess", se = FALSE, linewidth = 1, linetype = "dashed") +
  scale_color_manual(values = c("Raw values" = "grey", "Trend" = "blue"), name = "") +
  scale_x_date(
    date_labels = "%b %Y", 
    date_breaks = "1 month",
    limits = c(min(monthly_commit_counts$date), max(monthly_commit_counts$date)),
    expand = c(0,0)
  ) +
  labs(
    title = "Development Activity: Commits by Month",
    x = "Month",
    y = "Number of Commits"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank()
  ) 
```

