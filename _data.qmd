```{r}
#| include: false
#| warning: false

# Read pre-computed data from CSV files
issues_open <- read_language_data(lang, "issues_open")
prs_open <- read_language_data(lang, "prs_open")
issues_summary <- read_language_data(lang, "issues_summary")
prs_summary <- read_language_data(lang, "prs_summary")
mailing_list_data <- read_language_data(lang, "mailing_list")

# Filter for new contributors and no replies
if (nrow(issues_open) > 0) {
  issues_open_new <- issues_open[issues_open$author_association == "NONE", ]
  issues_open_no_replies <- issues_open[issues_open$comments == 0, ]
} else {
  issues_open_new <- issues_open
  issues_open_no_replies <- issues_open
}

if (nrow(prs_open) > 0) {
  prs_open_new <- prs_open[prs_open$author_association == "FIRST_TIME_CONTRIBUTOR", ]
  prs_open_no_replies <- prs_open[prs_open$comments == 0, ]
} else {
  prs_open_new <- prs_open
  prs_open_no_replies <- prs_open
}

# Stack Overflow data (already R-only)
vector_tags <- c("apache-arrow", lang)
if (lang == "Python") {
  vector_tags <- c(vector_tags, "pyarrow", "python")
}

questions_content <- get_questions(vector_tags)
so_data <- adjust_data(questions_content)
last_so_data <- so_data %>% filter(last_activity_date > now() - months(3))
last_so_data_not_accepted <- last_so_data %>% filter(accepted_answer == FALSE)
last_so_data_no_activity <- last_so_data %>% filter(answers == 0 & comments == 0)
```

## Row {.tabset}

### Summary

#### Column

##### Row {height=20%}

```{r}
#| content: valuebox
#| title: "Issues"
list(
  icon = "inboxes",
  color = "light",
  value = nrow(issues_open)
)
```

```{r}
#| content: valuebox
#| title: "Pull Requests"
list(
  icon = "diagram-2",
  color = "light",
  value = nrow(prs_open)
)
```

```{r}
#| content: valuebox
#| title: "Stack Overflow Questions"
list(
  icon = "stack-overflow",
  color = "light",
  value = nrow(last_so_data)
)
```

```{r}
#| content: valuebox
#| title: "Mailing List messages"
list(
  icon = "envelope",
  color = "light",
  value = nrow(mailing_list_data)
)
```

##### Row {height=80%}

```{r}
#| title: Issues opened through the last 3 months
create_fig(issues_summary$dates, issues_summary$others, issues_summary$new)
```

```{r}
#| title: PRs opened through the last 3 months
create_fig(prs_summary$dates, prs_summary$others, prs_summary$new)
```

### Issues & PRs

#### Row

```{r}
#| content: valuebox
#| title: "Open Issues"
list(
  icon = "list",
  color = "light",
  value = nrow(issues_open)
)
```

```{r}
#| content: valuebox
#| title: "Issues from New Contributors"
list(
  icon = "egg",
  color = "success",
  value = nrow(issues_open_new)
)
```

```{r}
#| content: valuebox
#| title: "Open PRs"
list(
  icon = "diagram-2",
  color = "light",
  value = nrow(prs_open)
)
```

```{r}
#| content: valuebox
#| title: "PRs from New Contributors"
list(
  icon = "emoji-heart-eyes",
  color = "success",
  value = nrow(prs_open_new)
)
```

#### Row

```{r}
#| title: Open issues (new contributors highlighted)
gt_show_issues(issues_open)
```

```{r}
#| title: Open PRs (new contributors highlighted)
gt_show_issues(prs_open)
```

### Stack Overflow

#### Row

```{r}
#| content: valuebox
#| title: "Questions in last 90 days"
list(
  icon = "question-square",
  color = "light",
  value = nrow(last_so_data)
)
```

```{r}
#| content: valuebox
#| title: "Questions without accepted answer"
list(
  icon = "question-diamond",
  color = "light",
  value = nrow(last_so_data_not_accepted)
)
```

```{r}
#| content: valuebox
#| title: "Questions with no activity"
list(
  icon = "question",
  color = "warning",
  value = nrow(last_so_data_no_activity)
)
```

#### Row

```{r}
#| title: Stack Overflow Questions
gt_show_questions(last_so_data)
```

### Mailing List

#### Row

```{r}
#| title: Mailing list items from the last month
gt_show_emails(mailing_list_data)
```
